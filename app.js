// Language translations for main application
const appTranslations = {
    english: {
        // Navigation
        portalSubtitle: "Transparency Portal",
        navDashboard: "Dashboard",
        navFinances: "Finances",
        navCommunity: "Community",
        navCouncil: "BSM Council",
        logoutText: "Logout",
        
        // Dashboard
        dashboardTitle: "Community Dashboard",
        dashboardSubtitle: "Overview of REDD+ project activities and community benefits",
        treesPlanted: "Trees Planted",
        benefitsDistributed: "Benefits Distributed",
        participatingHouseholds: "Participating Households",
        forestProtected: "Forest Protected",
        recentActivities: "Recent Activities",
        upcomingEvents: "Upcoming Events",
        activity1: "Tree planting exercise completed in Sector A - 500 new trees planted",
        activity2: "Quarterly benefit payments distributed to 342 households",
        activity3: "Community training on sustainable farming practices completed",
        event1: "Community Meeting",
        event2: "Monitoring Team Visit",
        benefitsChartTitle: "Benefits Distribution",
        progressChartTitle: "Project Progress",
        
        // Finances
        financesTitle: "Financial Transparency",
        financesSubtitle: "Complete overview of project finances and benefit distribution",
        totalBenefits: "Total Benefits Distributed",
        thisQuarter: "This Quarter",
        paymentHistory: "Payment History",
        breakdown1: "Carbon credits sold:",
        breakdown2: "Grants received:",
        breakdown3: "To households:",
        breakdown4: "Community projects:",
        dateHeader: "Date",
        typeHeader: "Payment Type",
        amountHeader: "Amount",
        statusHeader: "Status",
        payment1: "Quarterly Benefits",
        payment2: "Quarterly Benefits",
        payment3: "Quarterly Benefits",
        statusCompleted: "Completed",
        financeTrendTitle: "Financial Trends",
        
        // Community
        communityTitle: "Our Community",
        communitySubtitle: "Community members and project participation overview",
        totalMembers: "Total Members",
        activeHouseholds: "Active Households",
        participationRate: "Participation Rate",
        communityProjects: "Community Projects",
        project1: "Clean Water Initiative",
        project1Desc: "Installation of water wells in 3 villages to provide clean drinking water",
        project2: "Education Support",
        project2Desc: "Scholarships for 25 students and school supplies distribution",
        project3: "Health Center Upgrade",
        project3Desc: "Medical equipment and facility improvements for better healthcare",
        
        // BSM Council
        councilTitle: "BSM Council",
        councilSubtitle: "Benefit Sharing Mechanism Council Members and Activities",
        councilMembers: "Council Members",
        councilResponsibilities: "Council Responsibilities",
        position1: "Chairperson",
        position2: "Secretary",
        position3: "Treasurer",
        responsibility1: "Manage and oversee fair distribution of benefits to all community members",
        responsibility2: "Monitor and guide community project implementation",
        responsibility3: "Ensure complete transparency in financial reporting and management",
        responsibility4: "Represent community interests in REDD+ platform meetings"
    },
    
    mandinka: {
        // Navigation
        portalSubtitle: "Dimbayaŋo Portal",
        navDashboard: "Dashboard",
        navFinances: "Wari",
        navCommunity: "Siti",
        navCouncil: "BSM Kɔnko",
        logoutText: "Bɔta",
        
        // Dashboard
        dashboardTitle: "Siti Dashboard",
        dashboardSubtitle: "REDD+ porojɛti lafiyaluwo ani siti benefisiw la jarabi",
        treesPlanted: "Bunkono Dimiŋ",
        benefitsDistributed: "Benefisiw Dimiŋ",
        participatingHouseholds: "Dontolu Kaŋ Duwolu",
        forestProtected: "Kuwolu Senuŋ",
        recentActivities: "Sahafɛn Lafiyaluw",
        upcomingEvents: "A bisimila Lafiyaluw",
        activity1: "Bunkono dimiŋ lafiyaluwo bota Sector A kaŋ - 500 bunkono kura dimiŋ",
        activity2: "Benefisi wari dimiŋ 342 duwolu la saha fɛn na",
        activity3: "Siti karanko sustainable farming lafiyaluwo bota",
        event1: "Siti Meeting",
        event2: "Monitoring Team Visit",
        benefitsChartTitle: "Benefisiw Dimiŋ",
        progressChartTitle: "Porojɛti Dɔro",
        
        // Finances
        financesTitle: "Wari Laada",
        financesSubtitle: "Porojɛti wariwo ani benefisi dimiŋ la jarabi",
        totalBenefits: "Benefisiw Dimiŋ Moo",
        thisQuarter: "Saha Fɛn Nín",
        paymentHistory: "Wari Dimiŋ Tarihu",
        breakdown1: "Carbon credits sold:",
        breakdown2: "Grants received:",
        breakdown3: "Duwolu la:",
        breakdown4: "Siti porojɛtiw:",
        dateHeader: "Dɔnko",
        typeHeader: "Wari Fɛn",
        amountHeader: "Moo",
        statusHeader: "Dɔro",
        payment1: "Saha Fɛn Benefisiw",
        payment2: "Saha Fɛn Benefisiw",
        payment3: "Saha Fɛn Benefisiw",
        statusCompleted: "Bota",
        financeTrendTitle: "Wari Dɔrow",
        
        // Community
        communityTitle: "Ŋa Siti",
        communitySubtitle: "Siti dontolu ani porojɛti dɔntaya jarabi",
        totalMembers: "Dontolu Moo",
        activeHouseholds: "Lafiya Duwolu",
        participationRate: "Dɔntaya Pɛsɛŋo",
        communityProjects: "Siti Porojɛtiw",
        project1: "Clean Water Initiative",
        project1Desc: "Water wells dimiŋ 3 sitiw kaŋ, mini haako sani haaji diya",
        project2: "Education Support",
        project2Desc: "Scholarships 25 karandipo la ani karandi nafamo sani",
        project3: "Health Center Upgrade",
        project3Desc: "Medical equipment ani facility improvements, haaji diya lafiyarɔŋ",
        
        // BSM Council
        councilTitle: "BSM Kɔnko",
        councilSubtitle: "Benefisi Dimiŋ Laada Kɔnko Dontolu ani Lafiyaluw",
        councilMembers: "Kɔnko Dontolu",
        councilResponsibilities: "Kɔnko Karanfilu",
        position1: "Chairperson",
        position2: "Secretary",
        position3: "Treasurer",
        responsibility1: "Benefisi dimiŋ siti dontolu la karanfilu, hame la",
        responsibility2: "Siti porojɛti dimiŋ la jarabi ani dɔnkilija",
        responsibility3: "Wari laada jarabi karanfilu, hame la",
        responsibility4: "Siti dɔntaya wakilila REDD+ platform meetingw la"
    },
    
    wolof: {
        // Navigation
        portalSubtitle: "Portal bu Wone",
        navDashboard: "Dashboard",
        navFinances: "Xaalis",
        navCommunity: "Community",
        navCouncil: "BSM Council",
        logoutText: "Gener",
        
        // Dashboard
        dashboardTitle: "Dashboard bu Community bi",
        dashboardSubtitle: "Xoolal lépp lu ñu def ci project REDD+ ak benefis yi",
        treesPlanted: "Garab yi ñu Jëfandikoo",
        benefitsDistributed: "Benefis yi ñu Joxe",
        participatingHouseholds: "Këy yi Jëmale ci",
        forestProtected: "Ganaa yi ñu Daanu",
        recentActivities: "Li ñu Doon Def Bii",
        upcomingEvents: "Li Ñu Niyoo Def",
        activity1: "Gëm garab bi nekk Sector A - 500 garab yu bees",
        activity2: "Njàngor yi ñu joxe ci 342 këy ci trimester bi",
        activity3: "Jàng ci lu ëpp sustainable farming",
        event1: "Mbootaay bu Community",
        event2: "Equipe bu Xool di Ñëw",
        benefitsChartTitle: "Benefis yi ñu Joxe",
        progressChartTitle: "Màkkaan bu Project bi",
        
        // Finances
        financesTitle: "Wone Xaalis",
        financesSubtitle: "Xoolal xaalis yu project bi ak benefis yi ñu joxe",
        totalBenefits: "Benefis yi ñu Joxe Ci Lépp",
        thisQuarter: "Trimester Bii",
        paymentHistory: "Jëfandikoo yu Xaalis yi",
        breakdown1: "Carbon credits sold:",
        breakdown2: "Grants received:",
        breakdown3: "Ci këy yi:",
        breakdown4: "Project yu community:",
        dateHeader: "Bii",
        typeHeader: "Melo bu Njàngor bi",
        amountHeader: "Juroom",
        statusHeader: "Màkkaan",
        payment1: "Benefis yu Trimester",
        payment2: "Benefis yu Trimester",
        payment3: "Benefis yu Trimester",
        statusCompleted: "Fànn",
        financeTrendTitle: "Xeeti Xaalis",
        
        // Community
        communityTitle: "Sunu Community",
        communitySubtitle: "Way dëkk di jëmale ci project bi",
        totalMembers: "Way Dëkk Ci Lépp",
        activeHouseholds: "Këy yi Jëmale ci",
        participationRate: "Baaxaayu Jëmalekaay",
        communityProjects: "Project yu Community",
        project1: "Clean Water Initiative",
        project1Desc: "Doxum pënd yi ñu def ci 3 dëkk, ngir am ndox bu sell",
        project2: "Dimmbal ci Jàng",
        project2Desc: "Bourse ci 25 xale ak yëgléef yu jàng",
        project3: "Yokkatuwaayu Health Center",
        project3Desc: "Yëgléef yu medical ak yokkatuwaay, ngir am xarala bu baax",
        
        // BSM Council
        councilTitle: "BSM Council",
        councilSubtitle: "Way Council di séddandoo benefis ak li ñu def",
        councilMembers: "Way Council",
        councilResponsibilities: "Lépp lu ñu Wara Def",
        position1: "Borom Mbootaay",
        position2: "Secretary",
        position3: "Treasurer",
        responsibility1: "Toppatu benefis yi ci way dëkk ci anam gu yomb",
        responsibility2: "Xoolal project yu community yi ak duggale",
        responsibility3: "Wone xaalis bi nekk ci anam gu wér",
        responsibility4: "Wakil community ci mbootaay yu REDD+"
    },
    
    fulla: {
        // Navigation
        portalSubtitle: "Portal Hollirde",
        navDashboard: "Dashboard",
        navFinances: "Caɗe",
        navCommunity: "Community",
        navCouncil: "BSM Council",
        logoutText: "Yaltu",
        
        // Dashboard
        dashboardTitle: "Dashboard Community",
        dashboardSubtitle: "Yiyde golle REDD+ e ɗaɓɓe community",
        treesPlanted: "Legge Ceɗɗe",
        benefitsDistributed: "Ɗaɓɓe Ɓennude",
        participatingHouseholds: "Ƴiɗe Gollude",
        forestProtected: "Lesso Ɓamtaade",
        recentActivities: "Golle Cakkitiingol",
        upcomingEvents: "Golle Arataaɗe",
        activity1: "Ceɗɗe legge golle heɓii e Sector A - 500 ceɗɗe kese",
        activity2: "Ɗaɓɓe caɗe ɓennude 342 ɓiɗɗe cakkitiingol",
        activity3: "Jaŋde community e golle duumɗingol farming heɓii",
        event1: "Meeting Community",
        event2: "Fedde Yiyde Arata",
        benefitsChartTitle: "Ɗaɓɓe Ɓennude",
        progressChartTitle: "Jahdi Project",
        
        // Finances
        financesTitle: "Caɗe Hollirde",
        financesSubtitle: "Yiyde caɗe project e ɗaɓɓe ɓennude",
        totalBenefits: "Ɗaɓɓe Ɓennude Fuu",
        thisQuarter: "Cakkitiingol Ngon",
        paymentHistory: "Taariika Caɗe Ɓennude",
        breakdown1: "Carbon credits sold:",
        breakdown2: "Grants received:",
        breakdown3: "E ɓiɗɗe:",
        breakdown4: "Projecte community:",
        dateHeader: "Ñalngu",
        typeHeader: "Fannu Caɗe",
        amountHeader: "Ɓurɗu",
        statusHeader: "Ngonka",
        payment1: "Ɗaɓɓe Cakkitiingol",
        payment2: "Ɗaɓɓe Cakkitiingol",
        payment3: "Ɗaɓɓe Cakkitiingol",
        statusCompleted: "Ɓennii",
        financeTrendTitle: "Ceede Caɗe",
        
        // Community
        communityTitle: "Min Community",
        communitySubtitle: "Yimɓe community e ɓamtaade project yiyde",
        totalMembers: "Yimɓe Fuu",
        activeHouseholds: "Ƴiɗe Gollude",
        participationRate: "Ɓamtaade Ɓurɗo",
        communityProjects: "Projecte Community",
        project1: "Clean Water Initiative",
        project1Desc: "Nduddaku cecce ɗiɗi e 3 wuro, ngam ndiyam miija",
        project2: "Wallitorde Jaŋde",
        project2Desc: "Jaŋde ɓursi 25 jannginooɓe e jaŋde gawri",
        project3: "Ɓeydude Health Center",
        project3Desc: "Gawri medical e ɓeydude, ngam mbaadi ɓurɗo",
        
        // BSM Council
        councilTitle: "BSM Council",
        councilSubtitle: "Yimɓe Council ɓennude ɗaɓɓe e golle",
        councilMembers: "Yimɓe Council",
        councilResponsibilities: "Golle Wajjinde",
        position1: "Laamiiɗo",
        position2: "Secretary",
        position3: "Treasurer",
        responsibility1: "Fijirde ɓennude ɗaɓɓe e yimɓe community ɓurɗe",
        responsibility2: "Yiyde golle projecte community e dowrugol",
        responsibility3: "Hollirde caɗe e anndal ɓurɗe",
        responsibility4: "Wakil community e meetinge REDD+"
    }
};

// Current application state
let currentAppLanguage = 'english';
let charts = {};

// DOM Elements
const navItems = document.querySelectorAll('.nav-item');
const contentPages = document.querySelectorAll('.content-page');
const appLanguageSelect = document.getElementById('appLanguage');
const logoutBtn = document.getElementById('logoutBtn');

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    checkAuthentication();
    initializeApp();
});

// Check if user is authenticated
function checkAuthentication() {
    const isLoggedIn = localStorage.getItem('isLoggedIn');
    if (isLoggedIn !== 'true') {
        window.location.href = 'login.html';
        return;
    }
    
    // Set language from storage
    const savedLanguage = localStorage.getItem('language') || 'english';
    currentAppLanguage = savedLanguage;
    appLanguageSelect.value = savedLanguage;
    switchAppLanguage(savedLanguage);
}

// Initialize main application
function initializeApp() {
    initializeNavigation();
    initializeEventListeners();
    loadSampleData();
    
    // Initialize charts after a short delay to ensure DOM is ready
    setTimeout(initializeCharts, 100);
}

// Initialize navigation
function initializeNavigation() {
    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const targetPage = this.getAttribute('data-page');
            showPage(targetPage);
            
            // Update active nav item
            navItems.forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
        });
    });
}

// Show specific page
function showPage(pageId) {
    contentPages.forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    
    // Reinitialize charts when switching to their pages
    if (pageId === 'dashboard' && (charts.benefitsChart || charts.progressChart)) {
        setTimeout(() => {
            if (charts.benefitsChart) charts.benefitsChart.resize();
            if (charts.progressChart) charts.progressChart.resize();
        }, 300);
    }
    
    if (pageId === 'finances' && charts.financeChart) {
        setTimeout(() => {
            charts.financeChart.resize();
        }, 300);
    }
}

// Initialize charts - FIXED: Proper container sizing and responsive behavior
function initializeCharts() {
    // Benefits Distribution Chart (Dashboard)
    const benefitsCtx = document.getElementById('benefitsChart');
    if (benefitsCtx) {
        charts.benefitsChart = new Chart(benefitsCtx, {
            type: 'doughnut',
            data: {
                labels: ['Household Benefits', 'Community Projects', 'Conservation', 'Administration'],
                datasets: [{
                    data: [65, 20, 10, 5],
                    backgroundColor: [
                        '#2E8B57',
                        '#4A90E2',
                        '#FFA500',
                        '#9370DB'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 1.5,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            boxWidth: 12
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.parsed}%`;
                            }
                        }
                    }
                },
                cutout: '60%'
            }
        });
    }

    // Project Progress Chart (Dashboard)
    const progressCtx = document.getElementById('progressChart');
    if (progressCtx) {
        charts.progressChart = new Chart(progressCtx, {
            type: 'bar',
            data: {
                labels: ['Tree Planting', 'Training', 'Monitoring', 'Benefits'],
                datasets: [{
                    label: 'Completion %',
                    data: [85, 70, 90, 95],
                    backgroundColor: [
                        'rgba(46, 139, 87, 0.8)',
                        'rgba(74, 144, 226, 0.8)',
                        'rgba(255, 165, 0, 0.8)',
                        'rgba(147, 112, 219, 0.8)'
                    ],
                    borderColor: [
                        '#2E8B57',
                        '#4A90E2',
                        '#FFA500',
                        '#9370DB'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 1.5,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: {
                            display: true
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Finance Trends Chart (Finances)
    const financeCtx = document.getElementById('financeChart');
    if (financeCtx) {
        charts.financeChart = new Chart(financeCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Monthly Benefits ($)',
                    data: [12000, 19000, 15000, 25000, 22000, 30000, 28000, 35000, 32000, 40000, 38000, 45000],
                    borderColor: '#2E8B57',
                    backgroundColor: 'rgba(46, 139, 87, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 1.8,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            }
                        },
                        grid: {
                            display: true
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                }
            }
        });
    }
}

// Initialize event listeners
function initializeEventListeners() {
    // Language selector
    appLanguageSelect.addEventListener('change', function() {
        currentAppLanguage = this.value;
        switchAppLanguage(this.value);
        localStorage.setItem('language', this.value);
    });

    // Logout button
    logoutBtn.addEventListener('click', function() {
        // Show loading state
        const originalHTML = this.innerHTML;
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging out...';
        this.disabled = true;
        
        setTimeout(() => {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('username');
            window.location.href = 'login.html';
        }, 1000);
    });

    // Add interactive animations
    addAppAnimations();

    // Handle window resize for charts
    window.addEventListener('resize', function() {
        Object.values(charts).forEach(chart => {
            if (chart && typeof chart.resize === 'function') {
                chart.resize();
            }
        });
    });
}

// Switch application language
function switchAppLanguage(lang) {
    currentAppLanguage = lang;
    document.documentElement.setAttribute('data-language', lang);
    
    const translation = appTranslations[lang];
    
    // Update all translatable elements
    Object.keys(translation).forEach(key => {
        const elements = document.querySelectorAll(`[id="${key}"]`);
        elements.forEach(element => {
            element.textContent = translation[key];
        });
    });
}

// Load sample data
function loadSampleData() {
    console.log('Loading community data for REDD+ portal...');
    
    // Simulate data loading
    setTimeout(() => {
        console.log('Community data loaded successfully');
        updateUserWelcome();
    }, 500);
}

// Update user welcome message
function updateUserWelcome() {
    const username = localStorage.getItem('username') || 'Community Member';
    console.log(`Welcome, ${username}!`);
}

// Add interactive animations to the app
function addAppAnimations() {
    // Add hover effects to cards
    const cards = document.querySelectorAll('.stat-card, .project-card, .member-card, .responsibility-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.15)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
        });
    });

    // Add click effects to navigation
    navItems.forEach(item => {
        item.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    });
}

// Export for potential module use
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        switchAppLanguage,
        initializeCharts,
        showPage
    };
}